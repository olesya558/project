# -*- coding: utf-8 -*-
"""Матстат - Урок 1.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1QIVNnOc_pv2pjgejTJcfy5zoZKdsb-fD

## Урок 1
### Случайные события. Условная вероятность. Формула Байеса.  Независимые испытания

**Случайное событие** — то, которое при определенных условиях может произойти или нет.

Примеры случайного события:
1. При броске двух игральных костей на одной выпало число 1, а на другой — 2.
2. Клиент банка не вернул кредит.
3. Температура воздуха в Москве за последние десять дней не превышала 29 градусов по Цельсию.
4. Монету подбросили сто раз, орел выпал в 55 случаях.

Событие можно называть **достоверным**, если в результате испытания оно обязательно произойдет.

**Невозможное** событие не произойдет никогда.

Примеры достоверного события:
1. На игральной кости выпало число, не превышающее 6.
2. Подбросили монету, и выпал либо орел, либо решка.
3. Монету подбросили стократно, и решка выпала не более 100 раз.

Примеры невозможного события:
1. Две игральные кости бросили один раз, и сумма выпавших чисел составила 15.
2. Монету подбросили стократно, и решка выпала 55 раз, а орел — 56.
3. Три игральные кости бросили один раз, и сумма выпавших чисел составила 2.

Для случайного события есть понятие **относительной частоты** — это отношение количества состоявшихся событий к общему числу испытаний:

$$W(A) = \frac{m}{n}$$

В формуле $W(A)$ — это относительная частота события $A$;

$m$ — число состоявшихся событий $A$;

$n$ — общее число испытаний.

Рассмотрим примеры случайных событий.

**Пример 1**

Смоделируем 60-кратное подбрасывание игральной кости с помощью функции [random.randint](https://docs.scipy.org/doc/numpy-1.15.1/reference/generated/numpy.random.randint.html) пакета **numpy**, то есть $n$ = 60.

Событием $A$ будем считать выпадение числа 3 и найдем его относительную частоту.
"""

import numpy as np
n = 60

b = np.random.randint(1, 7, size=n)
b

"""Вычислим мощность подмножества, где в результате испытания выпадало число 3, то есть наблюдалось событие $A$:"""

m = len(b[b==3])

"""Теперь можем вычислить относительную частоту события $A$:"""

W = m / n
W

"""**Пример 2**

Разберем более сложный пример. Смоделируем ситуацию, когда бросают две игральные кости.

При этом будем находить частоту случайного события $B$, при котором на первой кости выпало 1, а на второй — 2. 

Проведем для этого 360 испытаний. Сразу зададим число $n$:
"""

n = 360



c = np.random.randint(1, 7, size=n)
d = np.random.randint(1, 7, size=n)

c

d

"""Числа, стоящие на одной позиции в массивах $c$ и $d$, будем считать результатами, полученными в одном испытании.

В первом испытании на игральной кости № 1 выпало число $c[0]$, а на № 2  — $d[0]$.
"""

c[0]

d[0]

"""Посчитаем число случав, когда в одном испытании на первой игральной кости выпало число 1, а на второй — 2."""

a = c[(c==1) & (d==2)]
m = len(a)
m

"""Вычислим относительную частоту события $B$:"""

W = m / n
W

"""#### Статистическая вероятность

При достаточно большом количестве испытаний $n$ величина относительной частоты $W$ будет стремиться к конкретному числу. Оно называется **статистической вероятностью** и обозначается как $P(A)$:

$$P(A) = \frac{m}{n}$$

Статистическую вероятность можно вычислить на основе данных, полученных по результатам многочисленных испытаний.

#### Классическое определение вероятности

Если заранее известны все вероятные исходы и они равновозможны (например, при подбрасывании монеты или игральной кости), можно воспользоваться **классическим определением вероятности**:

Вероятность события — это отношение числа элементарных исходов, благоприятствующих данному событию, к числу всех равновозможных исходов опыта, в котором оно может появиться.


Формула для этого определения такая же, как и для статистической вероятности:

$$P(A) = \frac{m}{n}$$

**Пример 3**

Вычислим вероятность того, что на игральной кости выпадет число 3. Известно, что у кости шесть граней с числами от 1 до 6 и каждая может выпасть с равной вероятностью. По формуле классической вероятности получаем результат:

$$P(A) = \frac{m}{n} = \frac{1}{6}$$

**Пример 4**

Вычислим, с какой вероятностью на игральной кости выпадет 2 или 4. Эти события в равной степени вероятны. Как следует из предыдущего примера, каждая из этих вероятностей равна 1/6. И эти события — несовместные, то есть не могут произойти одновременно. Поэтому мы можем складывать их вероятности:

$$P(A∨B) = \frac{1}{6} + \frac{1}{6} = \frac{2}{6}$$

($∨$ — знак логического ИЛИ).

#### Формулы комбинаторики

Для более сложных случаев число исходов $k$, благоприятствующих данному событию, или число всех элементарных исходов испытания ($n$) можно вычислить с помощью формул комбинаторики.

Число **сочетаний** из $n$ элементов по $k$ элементов в каждом (в сочетаниях порядок не важен):

$$C_n^k = \frac{n!}{k!(n - k)!}$$

Напишем функцию, чтобы вычислить количество сочетаний:
"""

from math import factorial

def combinations(n, k):
    return int(factorial(n) / (factorial(k) * factorial(n - k)))

"""Определим число **размещений** из $n$ элементов по $k$ элементов в каждом. При размещениях порядок важен, поэтому вариантов размещения может быть больше, чем сочетаний при заданных $k$  и $n$.

$$A_n^k = \frac{n!}{(n - k)!}$$
"""

def arrangements(n, k):
    return int(factorial(n) / factorial(n - k))

"""Число **перестановок** из $n$ элементов — при перестановках важен порядок, но отличие от размещений в том, что применяются все имеющиеся $n$ элементов:

$$P_n = n!$$
"""

def permutations(n):
    return int(factorial(n))

"""Рассмотрим на примерах, как применяются формулы комбинаторики.

**Пример 5**

Сколькими способами можно выбрать из колоды, состоящей из 36 карт, 4 карты?

Для ответа на этот вопрос воспользуемся формулой для вычисления количества сочетаний:

$$C_{36}^4 = \frac{36!}{4!(36 - 4)!} = \frac{36!}{4! \cdot 32!} = \frac{33 \cdot 34 \cdot 35 \cdot 36}{4!} = \frac{33 \cdot 34 \cdot 35 \cdot 36}{2 \cdot 3 \cdot 4} = 58905$$

или
"""

combinations(36, 4)

"""**Пример 6**

В магазине 20 покупателей. Сколькими способами они могут образовать очередь из 5 человек?

В этом примере важен порядок, в котором покупатели будут стоять в очереди, поэтому применим формулу для нахождения числа размещений:
"""

arrangements(20, 5)

"""**Пример 7**

Сколькими способами 5 покупателей могут образовать очередь?

Этот пример похож на предыдущий, но есть важное отличие: не нужно выбирать 5 покупателей из 20. Здесь их всего 5, и все должны присутствовать в очереди. Применим формулу для нахождения числа перестановок:
"""

permutations(5)

"""**Пример 8**

Из колоды, состоящей из 36 карт, случайным образом выбраны 5. Сколькими способами можно выбрать эти карты так, чтобы среди них оказалось от 2 до 3 тузов?

Чтобы решить эту задачу, нужно сначала рассмотреть ситуацию, когда выбирается два туза из четырех.

Число таких сочетаний будет равно:
"""

combinations(4, 2)

"""Остальные три карты выбираются из 32 карт  — тузы не рассматриваются, так как они уже выбраны:"""

combinations(32, 3)

"""И в этом случае будет такое число сочетаний, когда из колоды, в которой 36 карт, выбраны пять, две из которых — тузы:"""

6 * 4960

"""Теперь рассмотрим ситуацию выбора трех тузов из четырех. Число сочетаний будет равно:"""

combinations(4, 3)

"""Остальные две карты выбираются из 32 карт. Число сочетаний будет равно:"""

combinations(32, 2)

"""И тогда будет такое число сочетаний, когда из колоды в 36 карт выбраны пять, три из которых — тузы:"""

4 * 496

"""Осталось сложить полученные числа сочетаний:"""

29760 + 1984

"""Число комбинаций, полученных с помощью формул комбинаторики, можно складывать 
и умножать. Сложение в приведенном примере соответствует логическому ИЛИ, а умножение — логическому И.

**Совместные и несовместные события**

Совместные события могут произойти в одном испытании, а несовместные — нет. Например, при однократном подбрасывании игральной кости не могут сразу выпасть числа 3 и 4 — эти события несовместны. Если бросают две кости, на одной может выпасть 4, а на другой — 5, это совместные события. Вероятности несовместных событий можно складывать:

$$P(A + B) = P(A) + P(B)$$

В случае совместных событий формула суммы событий другая: из суммы вероятностей отдельных событий вычитается вероятность их совместного появления.

$$P(A + B) = P(A) + P(B) - P(AB)$$
"""



"""**Вероятность зависимых и независимых событий**

Независимыми события  называют, когда появление одного из них не влияет на появление другого. С зависимыми все наоборот.

Вероятность одновременного появления двух независимых событий вычисляется по формуле:

$$P(A*B) = P(A) * P(B)$$

Вероятность появления двух зависимых событий:

$$P(A*B) = P(A) * P(B\:|\:A) = P(B) * P(A\:|\:B)$$

**Пример 9**

Найдем вероятность того, что при броске двух игральных костей на первой выпадет четное число, а на второй — кратное трем. Сначала рассмотрим вероятность выпадения четного числа на первой кости. Таких случаев может быть три: это события, при которых выпадают числа 2, 4 и 6. Вероятность для каждого из них равна 1/6.

Так как эти три события являются несовместными, вероятность их суммы равна сумме их вероятностей:

$$P(четн.) = \frac{1}{6} + \frac{1}{6} + \frac{1}{6} = \frac{3}{6} = \frac{1}{2}$$

Для второй кости подходящих событий два: это выпадение чисел 3 и 6. Это тоже несовместные события, и мы можем сложить их вероятности:

$$P(кратн. 3) = \frac{1}{6} + \frac{1}{6} = \frac{2}{6} = \frac{1}{3}$$

С учетом того, что выпадение числа на одной кости не влияет на результат на другой — то есть эти события независимы, — применим умножение вероятностей и получим итоговый ответ:

$$P = \frac{1}{2} * \frac{1}{3} = \frac{1}{6}$$

**Формула полной вероятности**

Если событие $A$ может наступить только при появлении событий $B_1, B_2, \dots, B_n$, образующих полную группу несовместных событий*, то вероятность $A$ вычисляется по формуле:

***полная группа событий** означает, что при отдельном испытании обязательно возникнет одно из них.

$$P(A) = P(B_1) \cdot P(A\:|\:B_1) + P(B_2) \cdot P(A\:|\:B_2) \; + ... + \; P(B_n) \cdot P(A\:|\:B_n)$$

Выражение $P(B\;|\;A)$ означает вероятность наступления события $B$ при условии, что событие $A$ произошло.

**Пример 10**

Есть три одинаковые корзины. В первой лежат три красных и пять зеленых мячей, во второй — только красные, а в третьей — только зеленые мячи. Случайно выбирается одна корзина и из нее случайным образом извлекается мяч. 

Какова вероятность того, что этот мяч — зеленый?

Решим эту задачу с помощью формулы полной вероятности. Событием $A$ будем считать то, что достанут зеленый мяч, а событием $B$ — что выберут определенную корзину. Причем вероятность выбора одной из трех корзин будет равна 1/3.

Вероятность достать зеленый мяч при условии, что выбрана первая корзина, равен 5/(3 + 5), то есть 5/8. При выборе второй корзины вероятность вынуть зеленый мяч равна 0. В случае с третьей корзиной вероятность равна 1, так как все мячи в ней — зеленые.

Подставим данные значения в формулу полной вероятности и получим итоговый ответ:

$$P(A) = \frac{1}{3} \cdot \frac{5}{8} + \frac{1}{3} \cdot 0 + \frac{1}{3} \cdot 1 = \frac{5}{24} + 0 + \frac{1}{3} = \frac{13}{24}$$

#### Формула Байеса

Чтобы определить вероятность события $B$ при условии, что событие $A$ уже произошло, используют формулу Байеса:

$$P(B\:|\:A) = \frac{P(B) \cdot P(A\:|\:B)}{P(A)}$$

В данной формуле вероятность $P(B\;|\;A)$ называется апостериорной, то есть определенной после того, как произошло событие $A$. 

А вероятность $P(B)$ — априорной, определенной до испытания.

**Пример 11**

Соревнования по биатлону. Один из трех спортсменов стреляет и попадает в мишень. 

Вероятность такого события для первого спортсмена равна 0.2, для второго — 0.4, для третьего — 0.7.

Задача: найти вероятность того, что выстрелы произведены третьим спортсменом.

Прежде чем узнали результат выстрела, мы располагали только априорной вероятностью того, что выстрел был произведен, и она равнялась 1/3 — если учесть, что у всех спортсменов были равные возможности выстрелить.

Зная результат выстрела, мы можем заново оценить вероятности для каждого спортсмена — ведь точность у них разная. Эти вероятности будут апостериорными, так как они получены после поступления информации о том, что выстрел был удачным.

Событием $A$ будем считать попадание в мишень, а событиями $B_1, B_2$ и $B_3$ — что выстрел совершил первый, второй или третий спортсмен:

$$P(A\:|\:B_1) = 0.2$$

$$P(A\:|\:B_2) = 0.4$$

$$P(A\:|\:B_3) = 0.7$$

Вероятность того, что стрелял третий спортсмен — при условии, что выстрел был удачным, — будем находить по формуле:
"""



"""$$P(B_3\:|\:A) = \frac{P(B_3) \cdot P(A\:|\:B_3)}{P(A)}$$

---

Все величины подставим из условия, а знаменатель дроби распишем по формуле полной вероятности:

$$P(B_3\:|\:A) = \frac{\frac{1}{3} \cdot 0.7}{\frac{1}{3} \cdot 0.2 + \frac{1}{3} \cdot 0.4 + \frac{1}{3} \cdot 0.7} = \frac{7}{13}$$
"""